<html lang="en">
<head>
	<!-- METADATA -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- BOOTSTRAP CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

	<title>TP5 - Tableau Pays</title>

</head>
<body  onload="loadInfoPolluant(document.getElementById('tabpays'))">

	<div  class="container">
		<div class="navbar-nav">
			<a class="nav-link" href="../index.html">Accueil</a>
			<a class="nav-link active" href="#">Polluants Par Pays</a>
			<a class="nav-link" href="tp07_5_MaPageMeteo.html">Météo</a>
		</div>	
	</div>
	

	<div  class="container" id="tabpays">
		<h1></h1>
		<h2></h2>
	</div>

<!-- BOOTSTRAP SCRIPT JS -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script> -->

<script>
		let polluantParPays = {
	   "polluant": "CO2",
	   "unite": "milliards de tonnes",
	   "annee": 2017,
	   "pays": [
		   {
			   "nom": "Chine",
			   "valeur": 9.26,
			   "pourcentage": 28.2,
			   "code": "cn"
		   },
		   {
			   "nom": "Etats-Unis",
			   "valeur": 4.76,
			   "pourcentage": 14.5,
			   "code": "us"
		   },
		   {
			   "nom": "Inde",
			   "valeur": 2.16,
			   "pourcentage": 6.6,
			   "code": "in"
		   },
		   {
			   "nom": "Russie",
			   "valeur": 1.54,
			   "pourcentage": 4.7,
			   "code": "ru" 
		   },
		   {
			   "nom": "Japon",
			   "valeur": 1.13,
			   "pourcentage": 3.4,
			   "code": "jp"
		   },
		   {
			   "nom": "Allemagne",
			   "valeur": 0.72,
			   "pourcentage": 2.2,
			   "code": "de"
		   },
		   {
			   "nom": "Corée du Sud",
			   "valeur": 0.6,
			   "pourcentage": 1.8,
			   "code": "kr"
		   },
		   {
			   "nom": "Iran",
			   "valeur": 0.57,
			   "pourcentage": 1.7,
			   "code": "ir"
		   },
		   {
			   "nom": "Canada",
			   "valeur": 0.55,
			   "pourcentage": 1.7,
			   "code": "ca"
		   }
	   ]
	   };
   </script>
	<script>

		function loadInfoPolluant(doc){
			initH(doc);
			loadTable(doc)
 		}

		function initH(doc){
			//doc.querySelector("h1").innerHTML = polluantParPays.polluant;
			let title = `Pays les plus polluants pour le 
						${polluantParPays.polluant} (${polluantParPays.unite}) en ${polluantParPays.annee}`;
			
			doc.querySelector("h2").innerHTML = title;
		}


		function loadTable(doc){			
			let tab = loadTHead(doc);
			loadTBody(tab);
		}

		function loadTHead(doc){
			let newTab = document.createElement("table");
			newTab.className = "table table-striped table-hover table-bordered";
			
			let newTHead = document.createElement("thead");
			newTHead.className = "table-dark";
			newTab.appendChild(newTHead);
			doc.appendChild(newTab);

			let newTr = document.createElement("tr");
			newTHead.appendChild(newTr);

			let orderArrayHeader = ["","Nom","Qté","%"];
			orderArrayHeader.forEach(h => {
					let newTh = document.createElement("th");
					let textNode = document.createTextNode(h) ;
					newTh.setAttribute("scope","row");
					newTr.appendChild(newTh).appendChild(textNode);
					
				});
			return newTab; 
		}

		function loadTBody(tab){
			let newTBody = document.createElement("tbody");
			tab.appendChild(newTBody);

			for (const pays of polluantParPays.pays) {
				let newTr = document.createElement("tr");
				newTBody.appendChild(newTr);
				initTd(newTr,pays);
			}

		}

		function initTd(tr,p){
			let i = 1;
			for (const el of Object.entries(p)) {
				console.log(el);
				newTd = document.createElement("td");
				tr.appendChild(newTd);
			}

			td = tr.querySelectorAll("td");

			let img = document.createElement('img'); 
    		img.src = "https://flagcdn.com/16x12/" + p.code + ".png"; 
			td[0].appendChild(img);	
			td[1].innerHTML = p.nom;
			td[2].innerHTML = p.valeur;
			td[3].innerHTML = p.pourcentage;

		}


	</script>
</body>
</html>
